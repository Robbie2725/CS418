<!DOCTYPE>
<html lang="en">
<head>
  <title>MP2</title>
  <meta charset="utf-8">
</head>

<script id="blinn-phong-vs" type="x-shader/x-vertex">
attribute vec3 aVertexNormal;
attribute vec3 aVertexPosition;

uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;
uniform mat3 uNMatrix;

uniform vec3 kDiffuse1;
uniform vec3 kDiffuse2;
uniform vec3 kDiffuse3;
uniform vec3 kDiffuse4;

varying vec3 fragNormal;
varying vec3 vPositionEye;
varying vec3 diffuseColorInterpolated;

void main(void) {

  // Get the vertex position in eye coordinates
  vec4 vertexPositionEye4 = uMVMatrix * vec4(aVertexPosition, 1.0);
  vPositionEye = vertexPositionEye4.xyz / vertexPositionEye4.w;

  fragNormal = uNMatrix*aVertexNormal;

  if(aVertexPosition[2] > .05) diffuseColorInterpolated = kDiffuse1;
  else if(aVertexPosition[2] > 0.0 ) diffuseColorInterpolated = kDiffuse2;
  else if(aVertexPosition[2] > -.05) diffuseColorInterpolated = kDiffuse3;
  else diffuseColorInterpolated = kDiffuse4;

  gl_Position = uPMatrix*uMVMatrix*vec4(aVertexPosition, 1.0);
}
</script>

<script id="blinn-phong-fs" type="x-shader/x-fragment">
precision mediump float;

uniform vec3 uLightPosition;
uniform vec3 uDiffuseLightColor;
uniform vec3 uAmbientLightColor;
uniform vec3 uSpecularLightColor;

uniform vec3 uKAmbient;
uniform float uShininess;
uniform vec3 uKSpecular;

varying vec3 vPositionEye;
varying vec3 fragNormal;
varying vec3 diffuseColorInterpolated;

void main(void) {
    vec3 normalVector = normalize(fragNormal);
    vec3 lightVector = normalize(uLightPosition-vPositionEye);

    vec3 ka_ia = uKAmbient*uAmbientLightColor; // ambient light color * reflectivity

    float LdotN = max(dot(lightVector, normalVector), 0.0); // Diffuse lighting weight

    vec3 diffuseTerm = diffuseColorInterpolated*uDiffuseLightColor; // calculate the diffuse term

    //Now need to calculate the specular term
    vec3 viewVector = normalize(-vPositionEye); // get the view vector
    vec3 halfwayVector = normalize(viewVector+lightVector);
    float HdotN = max(dot(halfwayVector, normalVector), 0.0);
    float specWeight = pow(HdotN, uShininess*100.0);

    gl_FragColor = vec4(ka_ia+(LdotN*diffuseTerm)+(HdotN*specWeight), 1);
}
</script>

<script src="gl-matrix-min.js"></script>
<script src="webgl-utils.js"></script>
<script src="Terrain.js"></script>
<script src="mp2.js"></script>
<body onload="startup();">
  <canvas id="myGLCanvas" width="500" height="500"></canvas>
</body>
